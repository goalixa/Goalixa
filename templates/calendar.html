{% extends "layout.html" %}
{% set title = "Calendar" %}
{% set active_page = "calendar" %}

{% block content %}
  <div class="container py-4 calendar-page">
    <header class="header calendar-header">
      <div>
        <h1>Calendar</h1>
        <p>Review weekly streaks across your task list.</p>
      </div>
      <div class="calendar-week-meta">
        <span class="calendar-week-pill">{{ week_label }}</span>
        <span class="calendar-week-subtitle">Weekly check-ins</span>
      </div>
    </header>

    <section class="card calendar-week-board">
      <div class="calendar-week-grid calendar-week-header-row">
        <div class="calendar-weekday calendar-task-header">Tasks</div>
        {% for day in week_days %}
          <div class="calendar-weekday{% if day.is_today %} is-today{% endif %}">
            <span class="calendar-weekday-name">{{ day.day }}</span>
            <span class="calendar-weekday-date">{{ day.date }}</span>
          </div>
        {% endfor %}
      </div>

      {% if task_rows %}
        <div class="calendar-week-body">
          {% for task in task_rows %}
            <div class="calendar-week-grid calendar-week-row">
              <div class="calendar-task-cell">
                <span class="calendar-task-name">{{ task["name"] }}</span>
                <span class="calendar-task-meta">
                  {% if task["project_name"] %}{{ task["project_name"] }}{% else %}No project{% endif %}
                </span>
              </div>
              {% for day in week_days %}
                {% set checked = task.week_checks[loop.index0] %}
                <div class="calendar-day-cell{% if day.is_today %} is-today{% endif %}">
                  <span
                    class="calendar-check{% if checked %} is-checked{% else %} is-missed{% endif %}"
                    title="{{ day.full }}"
                  ></span>
                </div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="empty">No tasks yet.</p>
      {% endif %}
    </section>
  </div>
{% endblock %}
